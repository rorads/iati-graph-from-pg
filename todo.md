# TODO

- ✅ **[COMPLETED]** ~~**Graph Structure Note:** The current Neo4j graph model does not contain direct `(:PublishedActivity)-[:FINANCIAL_TRANSACTION]->(:PublishedActivity)` relationships. Financial transactions appear to link Organisations (Published/Phantom) to the PublishedActivities involved, typically representing the recipient organisation receiving funds *to* the activity, or the provider organisation disbursing funds *to* the activity. This needs to be considered when defining and querying funding chains.~~ Implemented a new `FUNDS` relationship that creates direct connections between activities, aggregating all relevant transaction types into a single directional relationship.

- ✅ **[COMPLETED]** ~~**Implement Efficient Database Wipe Functionality:** Create a Python utility that can safely and efficiently wipe the Neo4j database without hitting memory limits. This should use a batched approach to delete relationships first, then nodes, and finally remove all indexes and constraints with proper error handling and logging.~~

- **Improve Activity Hierarchy Relationships:** We have a first iteration of hierarchy relationships, but need to: a) refactor the implementation to use separate edge types for parent-child and sibling relationships instead of a single HIERARCHY edge with a relationship_type property, and b) optimise performance of the loading process. These changes should be made in the Python script (load_hierarchy_edges.py) rather than in the DBT model. The implementation should maintain the current functionality of recording which activities declared each relationship whilst improving query performance in Neo4j.

- **Add Activity Participation Relationships:** Implement a new "participating activity" relationship in Neo4j to capture where an activity is declared as the `activityid` in a participatingorg row. This will potentially duplicate some financial relationships but will serve as a useful checksum. Implementation should involve:
  1. Creating a new DBT model to identify these relationships
  2. Writing a separate Python script to load them into Neo4j
  3. Ensuring the relationship captures links between both published and phantom activities 